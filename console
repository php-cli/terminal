#!/usr/bin/env php
<?php

declare(strict_types=1);

require __DIR__ . '/vendor/autoload.php';

use Butschster\Commander\ExceptionRenderer;
use Butschster\Commander\Module\CommandBrowser\CommandBrowserModule;
use Butschster\Commander\Module\ComposerManager\ComposerModule;
use Butschster\Commander\Module\FileBrowser\FileBrowserModule;
use Butschster\Commander\Module\Git\GitModule;
use Butschster\Commander\SDK\Builder\ApplicationBuilder;
use Butschster\Commander\UI\Theme\MidnightTheme;
use Symfony\Component\Console\Application as SymfonyApplication;

// Create Symfony Console Application
$symfonyApp = new SymfonyApplication(name: 'My Console Application', version: '1.0.0');

// Add more commands here as needed
// $symfonyApp->add(new AnotherCommand());

try {
    $app = ApplicationBuilder::create()
        // Register modules
        ->withModule(module: new CommandBrowserModule(symfonyApp: $symfonyApp))
        ->withModule(module: new FileBrowserModule(initialPath: (string) \getcwd()))
        ->withModule(module: new ComposerModule(projectPath: __DIR__))
        ->withModule(module: new GitModule(repositoryPath: (string) \getcwd()))

        // Configuration
        ->withTheme(theme: new MidnightTheme())
        ->withFps(fps: 30)

        // Start with command browser
        ->withInitialScreen(screenName: 'command_browser')

        ->build();

    $app->run();
} catch (\Throwable $e) {
    echo (new ExceptionRenderer())->render($e, true);

    exit(1);
}
